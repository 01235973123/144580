(function(a,b,c,d,e,f,g,h){var i=null,j="",k=!1,l=0,m=null,n=250,o=function a(){return i?void(i.hide(),i.dispose(),i=null):void(i=null)},p=function a(){o(),i=new bootstrap.Modal("#restoration-dialog",{keyboard:!1}),i.show()},q=function c(a){return(console.debug("Incoming XHR message",a),""!==a.error)?a.stopError?(console.debug("Stop error detected"),void t(a.error)):(console.debug("Resumable detected"),void s(a.error)):1==+a.done?(console.debug("Restoration complete"),b.getElementById("restoration-progress").style.display="none",b.getElementById("restoration-success").style.display="block",b.getElementById("restoration-error").style.display="none",b.getElementById("restoration-retry").style.display="none",b.getElementById("restoration-success-nowarnings").style.display="block",b.getElementById("restoration-success-warnings").style.display="none",void(k&&(b.getElementById("restoration-success-nowarnings").style.display="hide",b.getElementById("restoration-success-warnings").style.display="show",b.getElementById("restoration-sql-log").innerText=j))):void(console.debug("Restoration needs more work"),b.getElementById("restoration-progress").style.display="block",b.getElementById("restoration-success").style.display="none",b.getElementById("restoration-error").style.display="none",b.getElementById("restoration-retry").style.display="none",b.getElementById("restoration-progress-wrap").setAttribute("aria-valuenow",a.percent),b.getElementById("restoration-progress-bar").style.width=a.percent+"%",b.getElementById("restoration-progress-bar").innerText=a.percent+"%",b.getElementById("restoration-lbl-restored").innerText=a.restored,b.getElementById("restoration-lbl-total").innerText=a.total,b.getElementById("restoration-lbl-eta").innerText=a.eta,!k&&0<a.errorcount&&(k=!0,j=a.errorlog,b.getElementById("restoration-warnings").style.display="block",b.getElementById("restoration-inprogress-log").innerText=j),console.debug("Will step in ".concat(n," msec")),setTimeout(r,n))},r=function a(){console.debug("Performing XHR request (step)");var b={view:"dbrestore",task:"step",format:"json",key:akeeba.System.getOptions("brs.database").key};akeeba.System.doAjax(b,q,t)},s=function c(a){return console.debug("Resumable error",a),3<l?(console.debug("Maximum retries exceeded; converting to stop error"),void t(a)):void(l++,console.debug("Currently on retry #".concat(l)),v(),b.getElementById("restoration-progress").style.display="none",b.getElementById("restoration-success").style.display="none",b.getElementById("restoration-error").style.display="none",b.getElementById("restoration-retry").style.display="block",b.getElementById("restoration-error-message-retry").innerHTML=a,w())},t=function c(a){console.debug("Stop error",a),b.getElementById("restoration-progress").style.display="none",b.getElementById("restoration-success").style.display="none",b.getElementById("restoration-error").style.display="block",b.getElementById("restoration-retry").style.display="none",b.getElementById("restoration-lbl-error").innerHTML=a},u=function a(){return v(),b.getElementById("restoration-error").style.display="none",b.getElementById("restoration-retry").style.display="none",b.getElementById("restoration-progress").style.display="block",r(),!1},v=function a(){clearInterval(m),b.getElementById("akeeba-retry-timeout").textContent="30"},w=function a(){var c=30;m=setInterval(function(){c--,b.getElementById("akeeba-retry-timeout").textContent=c.toFixed(0),0>=c&&(clearInterval(m),u())},1e3)};setTimeout(function a(){var c=b.getElementById("dbuser"),d=b.getElementById("dbpass"),e=akeeba.System.getOptions("brs.database");c&&null!==e&&void 0!==e&&e.dbuser&&(c.value=e.dbuser),d&&null!==e&&void 0!==e&&e.dbpass&&(d.value=e.dbpass)},500),null===(c=b.getElementById("specific_tables_addall"))||void 0===c||c.addEventListener("click",function a(){var c,d;Array.from(null!==(c=null===(d=b.getElementById("specific_tables"))||void 0===d?void 0:d.options)&&void 0!==c?c:[]).forEach(function(a){a.selected=!0})}),null===(d=b.getElementById("specific_tables_clearall"))||void 0===d||d.addEventListener("click",function a(){var c,d;Array.from(null!==(c=null===(d=b.getElementById("specific_tables"))||void 0===d?void 0:d.options)&&void 0!==c?c:[]).forEach(function(a){a.selected=!1})}),null===(e=b.getElementById("submitStep"))||void 0===e||e.addEventListener("click",function c(){console.debug("Getting database settings from the form");var d={view:"dbrestore",task:"start",format:"json",key:akeeba.System.getOptions("brs.database").key,dbinfo:{dbtype:"mysqli",dbhost:"localhost",dbuser:"",dbpass:"",dbname:"",dbencryption:0,dbsslcipher:"",dbsslcert:"",dbsslkey:"",dbsslca:"",dbsslverifyservercert:0,prefix:"",existing:"",foreignkey:0,noautovalue:0,replace:0,utf8db:0,utf8tables:0,utf8mb4:0,charset_conversion:0,break_on_failed_create:0,break_on_failed_insert:0,maxexectime:10,throttle:250}};return new FormData(b.getElementById("databaseSettingsContainer")).forEach(function(a,b){return d.dbinfo[b]=null!==a&&void 0!==a?a:""}),n=Math.min(Math.max(100,d.dbinfo.throttle),6e4),!1===/[A-Z]{1,}/.test(d.dbinfo.prefix)||a.confirm(akeeba.System.Text._("DATABASE_ERR_UPPERCASEPREFIX"))?!1!==/^[a-zA-Z0-9- ]*$/.test(d.dbinfo.dbpass)||a.confirm(akeeba.System.Text._("DATABASE_ERR_COMPLEXPASSWORD"))?d.dbinfo.dbhost.length&&d.dbinfo.dbuser.length&&d.dbinfo.dbpass.length&&d.dbinfo.dbname.length&&d.dbinfo.prefix.length||a.confirm(akeeba.System.Text._("DATABASE_ERR_EMPTY_INFO"))?void(console.debug("Setting up the model"),b.getElementById("restoration-progress-wrap").setAttribute("aria-valuenow","0"),b.getElementById("restoration-progress-bar").style.width="0%",b.getElementById("restoration-progress-bar").innerText="0%",b.getElementById("restoration-lbl-restored").innerText="",b.getElementById("restoration-lbl-total").innerText="",b.getElementById("restoration-lbl-eta").innerText="",b.getElementById("restoration-progress").style.display="block",b.getElementById("restoration-success").style.display="none",b.getElementById("restoration-error").style.display="none",b.getElementById("restoration-retry").style.display="none",b.getElementById("restoration-warnings").style.display="none",p(),l=0,k=!1,j="",console.debug("Performing XHR request (start)"),akeeba.System.doAjax(d,q,t)):void console.debug("Empty database information; user abort"):void console.debug("Complex password; user abort"):void console.debug("Uppercase letters in prefix; user abort")}),null===(f=b.getElementById("doneAndNext"))||void 0===f||f.addEventListener("click",function(){a.location=akeeba.System.getOptions("nextStep.url")}),null===(g=b.getElementById("restoration-cancel-resume"))||void 0===g||g.addEventListener("click",function a(){return v(),t(b.getElementById("restoration-error-message-retry").innerHTML),!1}),null===(h=b.getElementById("restoration-resume"))||void 0===h||h.addEventListener("click",u)})(window,document);

//# sourceMappingURL=database.min.js.map